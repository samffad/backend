define("sms/config",function(){var e=$.formatDate(new Date,"yyyyMM"),n=$.parseURL(location.href),o=n.scheme+":"+n.slash+n.host+(n.port?":"+n.port:""),t=(encodeURIComponent(o+"/"),(new Date).getTime()),r={logoutUrl:o+"/logout",loginUrl:o+"/",changeStore:"/login",api:{userLogin:"../test/logon.json",userInfo:"/userinfo/index.json",indexReport:"/userinfo/indexdata.json?viewType=bar,pie&yearMonth="+e,reportData:"/managerDetail/liststoredetail.json",reportDataDown:"/managerDetail/downloadexcel.json",jingjirendata:"/brokerDetail/listbrokerdetail.json",jingjirendataDown:"/brokerDetail/downloadexcel.json",jingjirenlist:"/mentor/getAllBrokers.json",jingjirensearch:"/mentor/getSuggest.json",jingjirenbuild:"/mentor/addRelation.json",jingjirenupdate:"/mentor/modifyRelation.json",jingjirendelete:"/mentor/deleteRelation.json",areaDataList:"../test/dataList.json",importFile:"/typecost/upload.json",daquReportData:"/areaDetail/listareadetail.json",daquReportDataDown:"/areaDetail/downloadexcel.json",fuzongReportData:"/companyDetail/listcompanydetail.json",fuzongReportDataDown:"/companyDetail/downloadexcel.json",storeSearch:"/areaDetail/searchstore.json",daquSearch:"/companyDetail/searcharea.json"}};for(var a in r.api)r.api[a]=r.api[a].indexOf("&")>=0?r.api[a]+"&__random="+t+"&":r.api[a]+"?__random="+t+"&";return r}),define("sms/userModel",function(require){function e(e){a=e,window.$currentUser=a.dataList[0],$.listener.trigger("getUserInfo",window.$currentUser)}function n(){window.sessionStorage.removeItem(i)}function o(e){var n=$.parseURL(e),o="";if(n.scheme&&(o+=n.scheme+":"),n.slash&&(o+=n.slash),n.host&&(o+=n.host),n.port&&(o+=":"+n.port),n.path&&(o+="/"+n.path),n.query){var t=$.queryToJson(n.query),r={};for(var a in t)$.inArray(a,d)<0&&(r[a]=t[a]);o=$.joinURL(o,r)}return o}var t=require("sms/config"),r=$.BaseModel,a=!1,i="_userInfoStroage_",s=function(){var e=!1;try{window.sessionStorage&&(e=window.sessionStorage.getItem(i))&&(e=JSON.parse(e))}catch(n){e=!1}return e},l=r.extend({urlRoot:t.api.userInfo,initialize:function(){var n=this;this.set("a","1"),this.once("change",function(){var o=n.toJSON();1==o.code&&(n.set("id","1"),e(n.toJSON()))})},laoding:!1,load:function(){var e=s();e?this.set(e):this.laoding||(this.laoding=!0,this.fetch())}}),d=["logoutUrl","proto_url"],c=!1;return $.listener.on("unlogin",function(){n(),!c&&alert("找不到用户信息"),c=!0;var e=t.loginUrl+"?proto_url="+encodeURIComponent(o(location.href));location.href=e}),$.listener.on("unAuth",function(){alert("没权限"),location.href=t.loginUrl+"?proto_url="+encodeURIComponent(o(location.href))}),new l}),define("sms/showUserInfoView",function(require){var e=require("sms/userModel"),n=Backbone.View.extend({model:e,el:"#jingjirenInfo",template:_.template($("#jingjirenInfoTemplate").html()),initialize:function(){var e=this;window.$currentUser?e.render(window.$currentUser):$.listener.on("getUserInfo",function(n,o){e.render(o)})},render:function(e){var n={data:e,code:1};this.$el.html(this.template(n))}});return e.load(),new n});