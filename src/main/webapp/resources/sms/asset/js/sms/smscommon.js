define("sms/config",function(){var e=$.formatDate(new Date,"yyyyMM"),t=$.parseURL(location.href),n=t.scheme+":"+t.slash+t.host+(t.port?":"+t.port:""),o=(encodeURIComponent(n+"/"),(new Date).getTime()),r={logoutUrl:n+"/logout",loginUrl:n+"/",changeStore:"/login",api:{userLogin:"../test/logon.json",userInfo:"/userinfo/index.json",indexReport:"/userinfo/indexdata.json?viewType=bar,pie&yearMonth="+e,reportData:"/managerDetail/liststoredetail.json",reportDataDown:"/managerDetail/downloadexcel.json",jingjirendata:"/brokerDetail/listbrokerdetail.json",jingjirendataDown:"/brokerDetail/downloadexcel.json",jingjirenlist:"/mentor/getAllBrokers.json",jingjirensearch:"/mentor/getSuggest.json",jingjirenbuild:"/mentor/addRelation.json",jingjirenupdate:"/mentor/modifyRelation.json",jingjirendelete:"/mentor/deleteRelation.json",areaDataList:"../test/dataList.json",importFile:"/typecost/upload.json",daquReportData:"/areaDetail/listareadetail.json",daquReportDataDown:"/areaDetail/downloadexcel.json",fuzongReportData:"/companyDetail/listcompanydetail.json",fuzongReportDataDown:"/companyDetail/downloadexcel.json",storeSearch:"/areaDetail/searchstore.json",daquSearch:"/companyDetail/searcharea.json"}};for(var a in r.api)r.api[a]=r.api[a].indexOf("&")>=0?r.api[a]+"&__random="+o+"&":r.api[a]+"?__random="+o+"&";return r}),define("sms/userModel",function(require){function e(e){a=e,window.$currentUser=a.dataList[0],$.listener.trigger("getUserInfo",window.$currentUser)}function t(){window.sessionStorage.removeItem(i)}function n(e){var t=$.parseURL(e),n="";if(t.scheme&&(n+=t.scheme+":"),t.slash&&(n+=t.slash),t.host&&(n+=t.host),t.port&&(n+=":"+t.port),t.path&&(n+="/"+t.path),t.query){var o=$.queryToJson(t.query),r={};for(var a in o)$.inArray(a,c)<0&&(r[a]=o[a]);n=$.joinURL(n,r)}return n}var o=require("sms/config"),r=$.BaseModel,a=!1,i="_userInfoStroage_",s=function(){var e=!1;try{window.sessionStorage&&(e=window.sessionStorage.getItem(i))&&(e=JSON.parse(e))}catch(t){e=!1}return e},l=r.extend({urlRoot:o.api.userInfo,initialize:function(){var t=this;this.set("a","1"),this.once("change",function(){var n=t.toJSON();1==n.code&&(t.set("id","1"),e(t.toJSON()))})},laoding:!1,load:function(){var e=s();e?this.set(e):this.laoding||(this.laoding=!0,this.fetch())}}),c=["logoutUrl","proto_url"],d=!1;return $.listener.on("unlogin",function(){t(),!d&&alert("找不到用户信息"),d=!0;var e=o.loginUrl+"?proto_url="+encodeURIComponent(n(location.href));location.href=e}),$.listener.on("unAuth",function(){alert("没权限"),location.href=o.loginUrl+"?proto_url="+encodeURIComponent(n(location.href))}),new l}),define("sms/showUserNameView",function(require){if($("#showUserName").length){var e=require("sms/userModel"),t=require("sms/config"),n=Backbone.View.extend({el:"#showUserName",template:_.template($("#showUserNameTemplate").html()),userMenuTemplate:_.template($("#userMenuTemplate").html()),initialize:function(){var e=this;$.listener.on("getUserInfo",function(t,n){e.render(n)})},render:function(e){var n={data:e,code:1,config:t};this.$el.html(this.template(n)),this.$el.show(),e&&!_.isArray(e.permissions)&&e.permissions&&(e.permissions=e.permissions.split(",")),$("#userMenu").html(this.userMenuTemplate(e)),this.trigger("menuReady",e)},load:function(){this.model.load()}});return new n({model:e})}}),define("sms/nav",function(){function e(e){if(e)for(var t=e.split(","),n=0;n<t.length;n++){var o=$("."+t[n]);if(!o.length){var r=$("#userMenu li a").eq(0).attr("href");location.href=r}$("."+t[n]).addClass("active")}}return{init:function(t,n){var o={page:"pageIndex"};return $.extend(o,t),n&&"accountant"==n.role.toLowerCase()&&"importPage"!=o.page?void(location.href="./import.html?v="+Math.floor(100*Math.random())):(e(o.page),$.listener.trigger("navReady"),void(window.navReady=1))}}}),$.BaseModel=function(e){return e.extend({constructor:function(e,t){var n=this,o={args:{},checkLogin:!0};return _.extend(o,t),n.option=o,n.on("change",function(){return"401"==n.get("code")&&$.listener.trigger("unlogin"),"402"==n.get("code")?void $.listener.trigger("unAuth"):!1}),o.parse&&(n.parse=o.parse),Backbone.Model.apply(this,arguments)},url:function(){var e=this,t=e.urlRoot||e.option.url;if(!t)throw"url is required";var n=t.indexOf("?");if(n>=0){var o=t.substring(n+1);o=$.queryToJson(o),_.extend(this.option.args,o),t=t.substring(0,n)}return $.extend(this.option.args,{__random:(new Date).getTime()}),$.joinURL(t,this.option.args)},setArgs:function(e){_.extend(this.option.args,e),this.fetch()},load:function(){this.fetch()}})}(Backbone.Model),define("common/BaseModel",function(){return $.BaseModel}),define("report/ReportCollection",function(){var e=Backbone.Collection.extend({});return e}),define("report/comp/ChartView",function(require){var e=[],t=function(t){t=t||window.echarts;for(var n=!1;n=e.pop();)n.view._chart=t.init(n.el),n.view._chart.setOption(n.data,!0)},n=!1,o=function(o,r,a){return e.push({view:o,el:r,data:a}),n?void(window.echarts&&t()):(n=!0,void require(["echarts","echarts/chart/bar","echarts/chart/pie"],function(e){t(e)}))},r=Backbone.View.extend({initialize:function(){var e=this;e.listenTo(e.model,"change",function(){e.render()})},_chart:!1,render:function(){var e=this,t=e.model.toJSON();o(e,e.$el.get(0),t.chartData)}});return r}),define("report/comp/barChart",function(require){function e(e,t,n,o,r){for(var a=0,i=t.length;i>a;a++)n[a]||(n[a]=0);var s={tooltip:{trigger:"axis"},calculable:!1,xAxis:[{type:"category",splitLine:{show:!1},data:t}],yAxis:[{boundaryGap:[0,0],type:"value"}],series:[{itemStyle:{normal:{label:{show:!0,position:"inside"}}},name:e,type:"bar",data:n}]};if(o){for(var l=[].concat(n),a=0;a<n.length;a++)n[a]=0!=parseFloat(r)?Math.floor(n[a]/r*1e4)/100:0;s.series[0].itemStyle.normal.label.show=!1,s.tooltip={trigger:"axis",formatter:function(e){for(var n=e[0][1],o=0,r=0,a=t.length;a>r;r++)if(t[r]==n){o=r;break}var i=l[o],s=n+":"+i+"<br/>"+e[0][0]+":"+e[0][2]+"%";return s}},s.yAxis[0].axisLabel={show:!0,interval:"auto",formatter:"{value} %"}}return s}var t=Backbone.Model,n=require("report/comp/ChartView");return function(o,r){var a=new t,i=new n({model:a,el:o.find(".chart-dom")[0]}),s=r.get("dataList");_.isArray(s)&&(s=s[0]);var l=e(r.get("name"),r.get("label"),s,r.get("showPercent"),r.get("total"));return a.set({sourceData:r.toJSON(),chartData:l}),i}}),define("report/comp/pieChart",function(require){function e(e,t,n){for(var o={},r=0,a=t.length;a>r;r++)n[r]||(n[r]=0),o[t[r]]=n[r];for(var i={tooltip:{trigger:"item",formatter:"{a} <br/>{b} : {c} ({d}%)"},legend:{orient:"vertical",x:"right",formatter:function(e){return e+o[e]+"元"},data:t},calculable:!1,series:[{itemStyle:{normal:{label:{position:"outer",formatter:function(e,t,n,o){return t+(o-0).toFixed(2)+"%"}},labelLine:{show:!0}}},name:e,radius:"55%",center:["45%","55%"],type:"pie",data:[]}]},s=[],r=0;r<t.length;r++)s.push({name:t[r],value:parseInt(n[r])});return i.series[0].data=s,i}var t=Backbone.Model,n=require("report/comp/ChartView");return function(o,r){var a=new t,i=new n({model:a,el:o.find(".chart-dom")[0]}),s=r.get("dataList");_.isArray(s)&&(s=s[0]);var l=e(r.get("name"),r.get("label"),s);return a.set({sourceData:r.toJSON(),chartData:l}),i}}),define("report/comp/tableComp",function(){return function(e,t,n){function o(e){var t=$('<span class="sort-icon actSort"><i class="arrow-up actUp"></i><i class="arrow-down actDown"></i></span>');e.append(t)}function r(){var n=t.get("sort");if(!n||!n.length)return!1;for(var r=e.find("th"),a=0,i=r.length;i>a;a++)$.inArray(r.eq(a).attr("thname"),n)>=0&&o(r.eq(a));return!0}function a(t,n){for(var o,r=$(t).closest("th").attr("thindex"),a=$(t).find("i"),i=e.find("tbody tr").toArray(),a=0;a<i.length;a++)for(var s=a+1;s<i.length;s++){var l=$(i[a]).children().eq(r).html(),c=$(i[s]).children().eq(r).html();try{_.isNaN(Number(l))||(l=Number(l)),_.isNaN(Number(c))||(c=Number(c))}catch(d){}n?c>l&&(o=i[a],i[a]=i[s],i[s]=o):l>c&&(o=i[a],i[a]=i[s],i[s]=o)}var u=e.find("tbody");_.each(i,function(e){u[0].appendChild(e)})}function i(e){var t=$(e.target);t.closest("tr").find(".on").removeClass("on"),t.addClass("on"),a(t,!1)}function s(e){var t=$(e.target);t.closest("tr").find(".on").removeClass("on"),t.addClass("on"),a(t,!0)}function l(){e.delegate(".actUp","click",i),e.delegate(".actDown","click",s)}function c(){var t=$(this);if(!t.hasClass("actPage"))return!1;var o=t.attr("page");return n.setArgs({page:o,curPage:o}),$("html , body").animate({scrollTop:e.offset().top},300),!1}function d(){e.delegate(".pagination li","click",c)}function u(){r()&&l(),d()}var p={};return p.destroy=function(){e.undelegate(),d()},u(),p}}),define("report/ReportView",function(require){var e=require("report/ReportCollection"),t=Backbone.View.extend({plugin:{bar:require("report/comp/barChart"),pie:require("report/comp/pieChart"),table:require("report/comp/tableComp")},initialize:function(){var t=this;t.collection=new e,t.listenTo(t.model,"sync",function(){var e=!1,n=t.model.toJSON();t.parse?(e=t.parse(n),n.dataList&&(n.data=n,n.data.list=e,t.model.set(n))):e=n.data&&n.data.list,t.collection.reset(e)}),t.listenTo(t.model,"error",function(){t.$el.html("数据请求失败")}),t.listenTo(t.collection,"reset",function(){t.render()}),t.template=_.template($("#"+t.$el[0].id+"Template").html()),t._comps=[]},init:function(){this.model.load()},setArgs:function(e){this.model.setArgs(e)},render:function(){var e=this,t=e.model.toJSON().data;t&&e.model.option&&(t.args=e.model.option.args),e.$el.html(e.template(t)),e.loadComp()},addPlugin:function(e,t){this.plugin[e]=t},loadComp:function(){var e=this,t=!1;if(e._comps)for(;t=e._comps.pop();)t.destroy&&t.destroy();for(var n=e.$el.find(".comp-content"),o=!1,r=0;r<e.collection.length;r++){o=e.collection.at(r);var a=e.plugin[o.get("type")];a&&e._comps.push(a(n.eq(r),o,e))}}});return t}),define("sms/smscommon",function(require){var e=require("sms/showUserNameView"),t=require("sms/nav");try{$(document).ready(function(){e.once("menuReady",function(e){window.pageConfig&&t.init(window.pageConfig,e)}),e&&e.load&&e.load()})}catch(n){console&&console.error(n)}$.BaseModel=require("common/BaseModel"),$.ReportView=require("report/ReportView"),$.config=require("sms/config"),$.listener.trigger("commmReady")});