define("sms/suggestView",function(){function e(e){return e.val().length}var t=$.BaseModel,a=Backbone.Model.extend(),r=Backbone.Collection.extend({model:a,parse:function(e){return e?e.data:[]}}),n=t.extend({initialize:function(){var e=this,t=this.get("collection");e.on("change",function(){t.url=$.joinURL(e.get("url"),e.get("args"));var a=e.get("args")[e.keyword]||"";if(e.isStatic&&e.collData){for(var r=[],n=0;n<e.collData.length;n++){var i=e.collData[n];i.name.indexOf(a)>=0&&r.push(i)}t.set(r),t.trigger("sync")}else t.fetch()})},setArgs:function(e){var t=this,a=_.clone(t.get("args"));$.extend(a,e),t.set("args",a),t.trigger("change")},saveDataList:function(e){var t=this;t.collData=e}}),i=Backbone.View.extend({template:_.template('<%for(var i =0;i<list.length;i++){%><li actVal="<%=list[i].value%>"><a href="javascript:;"><%=list[i].name%><%=list[i].value?("("+list[i].value+")"):""%></a></li><%}%>'),className:"ttt",initialize:function(){var e=this;this.listenTo(e.collection,"sync",function(){e.render()}),e.on("enter",function(t){e.$(".dropdown-menu").hide();var a=e.collection.at(t);a&&(e.$("[type='hidden']").val(a.get("value")),e.$("[type='text']").val(a.get("name"))),e.trigger("selectValue",a)}),$(document.body).on("click",function(){e.$(".dropdown-menu").hide()})},clearData:function(){var e=this;e.$("[type='hidden']").val(""),e.trigger("selectValue",!1)},render:function(){var e=this,t=e.$(".dropdown-menu"),a=e.collection.toJSON();a.length?(t.html(e.template({list:a})),t.show()):t.hide()},events:{"keyup input":"keyup","keydown input":"keydown","focus input":"setSearchValue","click input":"setSearchValue","click .actFocus":"focus","mouseenter li":"mouseenter","click li":"select"},focus:function(e){var t=this;$(e.currentTarget).blur();var a=this.$("input"),r={};return r[a.attr("name")]="",t.model.setArgs(r),!1},keydown:function(e){$.inArray(e.keyCode,[38,40,13])>=0&&(e.preventDefault(),e.stopPropagation())},keyup:function(e){var t=this;switch(e.keyCode){case 8:t.clearData(),t.setSearchValue();break;case 38:return t.pre(),e.preventDefault(),e.stopPropagation(),!1;case 40:return e.preventDefault(),e.stopPropagation(),t.next(),!1;case 13:return t.enter(),!1;default:t.setSearchValue()}return!1},scrollToCur:function(e){e=$(e);var t=e.parent(),a=e.get(0).offsetTop;a>t.height()+t.get(0).scrollTop&&(t.get(0).scrollTop=a-t.height()+2*e.height()),t.get(0).scrollTop>a&&(t.get(0).scrollTop=a-t.height())},pre:function(){var e=this,t=e.$("li");if(t.length){var a=e._getCurSelect(),r=-1;a>=0&&(r=a-1),t.removeClass("active"),t.eq(r).addClass("active"),e.scrollToCur(t.eq(r))}},next:function(){var e=this,t=e.$("li");if(t.length){var a=e._getCurSelect(),r=-1;r=a>=t.length-1?0:a+1,t.removeClass("active"),t.eq(r).addClass("active"),e.scrollToCur(t.eq(r))}},enter:function(){var e=this,t=e._getCurSelect();e.trigger("enter",-1==t?0:t)},_getCurSelect:function(){for(var e=this,t=e.$("li"),a=0,r=t.length;r>a;a++)if(t.eq(a).hasClass("active"))return a;return-1},select:function(e){var t=e.currentTarget;this.$("li").removeClass("active"),$(t).addClass("active"),this.enter()},mouseenter:function(e){var t=e.currentTarget;this.$("li").removeClass("active"),$(t).addClass("active")},_searchTimeout:!1,setSearchValue:function(){var t=this;t._searchTimeout&&clearTimeout(t._searchTimeout),t._searchTimeout=setTimeout(function(){var a=t.$("input"),r=e(a),n=a.val().substring(0,r),i={};i[a.attr("name")]=n,t.model.setArgs(i)},300)},initSearchData:function(e){var t=this,a=t.$("input");e=e||{},e[a.attr("name")]="";var r=t.model;r.keyword=a.attr("name"),$.ajax({url:$.joinURL(r.get("url"),e)}).success(function(e){var a=t.collection.parse(e);a&&a.length&&t.model.saveDataList(a)})}});return function(e){var t={url:"",args:{},el:"",parse:!1};$.extend(t,e);var a=new r({});t.parse&&(a.parse=t.parse);var l=new n({collection:a,args:t.args,url:t.url}),s=new i({collection:a,model:l,el:t.el});return t.isStatic&&(l.isStatic=!0,s.initSearchData(t.args)),s}});