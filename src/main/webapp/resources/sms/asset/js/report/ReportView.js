define("report/ReportCollection",function(){var t=Backbone.Collection.extend({});return t}),define("report/comp/ChartView",function(require){var t=[],e=function(e){e=e||window.echarts;for(var r=!1;r=t.pop();)r.view._chart=e.init(r.el),r.view._chart.setOption(r.data,!0)},r=!1,a=function(a,o,n){return t.push({view:a,el:o,data:n}),r?void(window.echarts&&e()):(r=!0,void require(["echarts","echarts/chart/bar","echarts/chart/pie"],function(t){e(t)}))},o=Backbone.View.extend({initialize:function(){var t=this;t.listenTo(t.model,"change",function(){t.render()})},_chart:!1,render:function(){var t=this,e=t.model.toJSON();a(t,t.$el.get(0),e.chartData)}});return o}),define("report/comp/barChart",function(require){function t(t,e,r,a,o){for(var n=0,i=e.length;i>n;n++)r[n]||(r[n]=0);var l={tooltip:{trigger:"axis"},calculable:!1,xAxis:[{type:"category",splitLine:{show:!1},data:e}],yAxis:[{boundaryGap:[0,0],type:"value"}],series:[{itemStyle:{normal:{label:{show:!0,position:"inside"}}},name:t,type:"bar",data:r}]};if(a){for(var c=[].concat(r),n=0;n<r.length;n++)r[n]=0!=parseFloat(o)?Math.floor(r[n]/o*1e4)/100:0;l.series[0].itemStyle.normal.label.show=!1,l.tooltip={trigger:"axis",formatter:function(t){for(var r=t[0][1],a=0,o=0,n=e.length;n>o;o++)if(e[o]==r){a=o;break}var i=c[a],l=r+":"+i+"<br/>"+t[0][0]+":"+t[0][2]+"%";return l}},l.yAxis[0].axisLabel={show:!0,interval:"auto",formatter:"{value} %"}}return l}var e=Backbone.Model,r=require("report/comp/ChartView");return function(a,o){var n=new e,i=new r({model:n,el:a.find(".chart-dom")[0]}),l=o.get("dataList");_.isArray(l)&&(l=l[0]);var c=t(o.get("name"),o.get("label"),l,o.get("showPercent"),o.get("total"));return n.set({sourceData:o.toJSON(),chartData:c}),i}}),define("report/comp/pieChart",function(require){function t(t,e,r){for(var a={},o=0,n=e.length;n>o;o++)r[o]||(r[o]=0),a[e[o]]=r[o];for(var i={tooltip:{trigger:"item",formatter:"{a} <br/>{b} : {c} ({d}%)"},legend:{orient:"vertical",x:"right",formatter:function(t){return t+a[t]+"元"},data:e},calculable:!1,series:[{itemStyle:{normal:{label:{position:"outer",formatter:function(t,e,r,a){return e+(a-0).toFixed(2)+"%"}},labelLine:{show:!0}}},name:t,radius:"55%",center:["45%","55%"],type:"pie",data:[]}]},l=[],o=0;o<e.length;o++)l.push({name:e[o],value:parseInt(r[o])});return i.series[0].data=l,i}var e=Backbone.Model,r=require("report/comp/ChartView");return function(a,o){var n=new e,i=new r({model:n,el:a.find(".chart-dom")[0]}),l=o.get("dataList");_.isArray(l)&&(l=l[0]);var c=t(o.get("name"),o.get("label"),l);return n.set({sourceData:o.toJSON(),chartData:c}),i}}),define("report/comp/tableComp",function(){return function(t,e,r){function a(t){var e=$('<span class="sort-icon actSort"><i class="arrow-up actUp"></i><i class="arrow-down actDown"></i></span>');t.append(e)}function o(){var r=e.get("sort");if(!r||!r.length)return!1;for(var o=t.find("th"),n=0,i=o.length;i>n;n++)$.inArray(o.eq(n).attr("thname"),r)>=0&&a(o.eq(n));return!0}function n(e,r){for(var a,o=$(e).closest("th").attr("thindex"),n=$(e).find("i"),i=t.find("tbody tr").toArray(),n=0;n<i.length;n++)for(var l=n+1;l<i.length;l++){var c=$(i[n]).children().eq(o).html(),s=$(i[l]).children().eq(o).html();try{_.isNaN(Number(c))||(c=Number(c)),_.isNaN(Number(s))||(s=Number(s))}catch(d){}r?s>c&&(a=i[n],i[n]=i[l],i[l]=a):c>s&&(a=i[n],i[n]=i[l],i[l]=a)}var p=t.find("tbody");_.each(i,function(t){p[0].appendChild(t)})}function i(t){var e=$(t.target);e.closest("tr").find(".on").removeClass("on"),e.addClass("on"),n(e,!1)}function l(t){var e=$(t.target);e.closest("tr").find(".on").removeClass("on"),e.addClass("on"),n(e,!0)}function c(){t.delegate(".actUp","click",i),t.delegate(".actDown","click",l)}function s(){var e=$(this);if(!e.hasClass("actPage"))return!1;var a=e.attr("page");return r.setArgs({page:a,curPage:a}),$("html , body").animate({scrollTop:t.offset().top},300),!1}function d(){t.delegate(".pagination li","click",s)}function p(){o()&&c(),d()}var u={};return u.destroy=function(){t.undelegate(),d()},p(),u}}),define("report/ReportView",function(require){var t=require("report/ReportCollection"),e=Backbone.View.extend({plugin:{bar:require("report/comp/barChart"),pie:require("report/comp/pieChart"),table:require("report/comp/tableComp")},initialize:function(){var e=this;e.collection=new t,e.listenTo(e.model,"sync",function(){var t=!1,r=e.model.toJSON();e.parse?(t=e.parse(r),r.dataList&&(r.data=r,r.data.list=t,e.model.set(r))):t=r.data&&r.data.list,e.collection.reset(t)}),e.listenTo(e.model,"error",function(){e.$el.html("数据请求失败")}),e.listenTo(e.collection,"reset",function(){e.render()}),e.template=_.template($("#"+e.$el[0].id+"Template").html()),e._comps=[]},init:function(){this.model.load()},setArgs:function(t){this.model.setArgs(t)},render:function(){var t=this,e=t.model.toJSON().data;e&&t.model.option&&(e.args=t.model.option.args),t.$el.html(t.template(e)),t.loadComp()},addPlugin:function(t,e){this.plugin[t]=e},loadComp:function(){var t=this,e=!1;if(t._comps)for(;e=t._comps.pop();)e.destroy&&e.destroy();for(var r=t.$el.find(".comp-content"),a=!1,o=0;o<t.collection.length;o++){a=t.collection.at(o);var n=t.plugin[a.get("type")];n&&t._comps.push(n(r.eq(o),a,t))}}});return e});